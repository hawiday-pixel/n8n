{
  "name": "TNER | Finance | get-pl-report",
  "nodes": [
    {
      "parameters": {},
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        256,
        304
      ],
      "id": "manual-trigger-pl"
    },
    {
      "parameters": {
        "url": "https://api.xero.com/api.xro/2.0/Reports/ProfitAndLoss",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "xeroOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fromDate",
              "value": "2025-11-01"
            },
            {
              "name": "toDate",
              "value": "2025-11-30"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "xero-tenant-id",
              "value": "03d1cbbb-0674-4de3-b489-55d8dfeea5c6"
            }
          ]
        },
        "options": {}
      },
      "name": "Get Xero P&L",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        464,
        304
      ],
      "id": "get-pl",
      "credentials": {
        "xeroOAuth2Api": {
          "id": "REDACTED",
          "name": "Xero account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const report = $input.item.json;\nconst reports = report.Reports || [];\n\nif (reports.length === 0) {\n  return [{json: {message: 'ğŸ“Š TNER P&L - November 2025\\n\\nâŒ No financial data available'}}];\n}\n\nconst reportData = reports[0];\nconst rows = reportData.Rows || [];\n\nlet message = `ğŸ“Š TNER (ALWC PTE LTD)\\nProfit & Loss - November 2025\\n\\n`;\n\nlet totalRevenue = 0;\nlet totalExpenses = 0;\n\n// Parse income\nconst income = rows.find(r => r.RowType === 'Section' && (r.Title?.includes('Income') || r.Title?.includes('Revenue')));\nif (income && income.Rows) {\n  message += `ğŸ’° REVENUE\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n  income.Rows.forEach(row => {\n    if (row.Cells && row.Cells.length >= 2 && row.RowType === 'Row') {\n      const account = row.Cells[0]?.Value || '';\n      const amount = parseFloat(row.Cells[1]?.Value || '0');\n      if (account && amount !== 0) {\n        totalRevenue += amount;\n        message += `${account}: $${amount.toFixed(2)}\\n`;\n      }\n    }\n  });\n  message += `\\nTotal: $${totalRevenue.toFixed(2)}\\n\\n`;\n}\n\n// Parse expenses\nconst expenses = rows.find(r => r.RowType === 'Section' && r.Title?.includes('Expense'));\nif (expenses && expenses.Rows) {\n  message += `ğŸ’¸ EXPENSES\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n  expenses.Rows.forEach(row => {\n    if (row.Cells && row.Cells.length >= 2 && row.RowType === 'Row') {\n      const account = row.Cells[0]?.Value || '';\n      const amount = parseFloat(row.Cells[1]?.Value || '0');\n      if (account && amount !== 0) {\n        totalExpenses += Math.abs(amount);\n        message += `${account}: $${Math.abs(amount).toFixed(2)}\\n`;\n      }\n    }\n  });\n  message += `\\nTotal: $${totalExpenses.toFixed(2)}\\n\\n`;\n}\n\nconst netProfit = totalRevenue - totalExpenses;\nconst emoji = netProfit >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';\n\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n${emoji} NET PROFIT: $${netProfit.toFixed(2)}`;\n\nreturn [{json: {message}}];"
      },
      "name": "Format Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        304
      ],
      "id": "format"
    },
    {
      "parameters": {
        "chatId": "397780826",
        "text": "={{ $json.message }}",
        "additionalFields": {}
      },
      "name": "Send to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        864,
        304
      ],
      "id": "telegram",
      "webhookId": "c0ee9da9-6301-44bb-be2e-6aac8a4f6226",
      "credentials": {
        "telegramApi": {
          "id": "REDACTED",
          "name": "Hawdybot"
        }
      }
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Get Xero P&L",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Xero P&L": {
      "main": [
        [
          {
            "node": "Format Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report": {
      "main": [
        [
          {
            "node": "Send to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "executionTimeout": 3600,
    "timezone": "UTC"
  },
  "staticData": null,
  "meta": {
    "exportedAt": "2025-12-06T05:32:08.848Z",
    "n8nId": "MePHafyC1YriCbA2",
    "active": false,
    "note": "Credentials and secrets have been redacted. Re-configure in n8n after import."
  }
}